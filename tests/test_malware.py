import json

import pytest

from app.app import app

with open('tests/testdata.json', 'r') as file:
    data = json.loads(file.read())

@pytest.mark.parametrize('host, path', data['unsafedomains'])
def test_is_malware_true(setup_data, host, path):
    with app.test_client() as test_client:
        res = test_client.get(f'/api/1/{host}/{path}')
        assert res.status_code == 200
        assert json.loads(res.data)['is_safe'] == False


@pytest.mark.parametrize('host, path', data['safedomains'])
def test_is_malware_false(setup_data, host, path):
    with app.test_client() as test_client:
        res = test_client.get(f'/api/1/{host}/{path}')
        assert res.status_code == 200
        assert json.loads(res.data)['is_safe'] == True